<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-signin-client_id" content="773865792273-bmfeq59m4ngolie007m7sgmgneourc7s.apps.googleusercontent.com">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="style_ec2.css">
    <link rel="icon" href="https://www.it.kmitl.ac.th/wp-content/uploads/2017/12/cropped-it-logo-180x180.png">

    <title>EC2</title>
</head>
<body>
    <nav class="navbar navbar-expand-md navbar-lght bg-light">
        <a class="navbar-brand text-body" href="#">
            <img src="https://www.it.kmitl.ac.th/wp-content/uploads/2017/12/cropped-it-logo-180x180.png" width="30" height="30" class="d-inline-block align-top" alt="" loading="lazy">
            AWS Resource Management System
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsingNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-collapse collapse" id="collapsingNavbar">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link text-body" href="#">
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-house-door" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M7.646 1.146a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 .146.354v7a.5.5 0 0 1-.5.5H9.5a.5.5 0 0 1-.5-.5v-4H7v4a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-7a.5.5 0 0 1 .146-.354l6-6zM2.5 7.707V14H6v-4a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v4h3.5V7.707L8 2.207l-5.5 5.5z"/>
                            <path fill-rule="evenodd" d="M13 2.5V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"/>
                        </svg>
                        Home
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-body" href="#">
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-door-open" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M1 15.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13a.5.5 0 0 1-.5-.5zM11.5 2H11V1h.5A1.5 1.5 0 0 1 13 2.5V15h-1V2.5a.5.5 0 0 0-.5-.5z"/>
                            <path fill-rule="evenodd" d="M10.828.122A.5.5 0 0 1 11 .5V15h-1V1.077l-6 .857V15H3V1.5a.5.5 0 0 1 .43-.495l7-1a.5.5 0 0 1 .398.117z"/>
                            <path d="M8 9c0 .552.224 1 .5 1s.5-.448.5-1-.224-1-.5-1-.5.448-.5 1z"/>
                          </svg>
                        Sign out
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex bd-highlight">
                            <div class="p-2 w-100 bd-highlight">
                                <h5 class="card-title">EC2</h5>
                                <h6 class="card-subtitle mb-2 text-muted">Create, Start, Stop and Terminate EC2 Instance</h6>
                            </div>
                            <div class="p-2 flex-shrink-1 bd-highlight">
                                <button type="button" class="btn btn-outline-dark">
                                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-arrow-clockwise" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                                        <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                                    </svg>  
                                </button>
                            </div>
                          </div>
                        <div class="container-fluid">
                            <table class="table table-hover table-responsive">
                                <thead>
                                <tr>
                                    <th class="col-1">Select</th>
                                    <th class="col-5">Name</th>
                                    <th class="col-5">Instance ID</th>
                                    <th class="col-2">Instance State</th>
                                    <th class="col-2">Instance Type</th>
                                    <th class="col">Availability Zone</th>
                                    <th class="col">Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                                            </div>
                                        </td>
                                        <td>Bastion</td>
                                        <td>i-0deeed0850be163ae</td>
                                        <td>Running</td>
                                        <td>t2.micro</td>
                                        <td>ap-southeast-1</td>
                                        <td>
                                            <button type="button" class="btn btn-success btn-sm" id="start">
                                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-power" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" d="M5.578 4.437a5 5 0 1 0 4.922.044l.5-.866a6 6 0 1 1-5.908-.053l.486.875z"/>
                                                    <path fill-rule="evenodd" d="M7.5 8V1h1v7h-1z"/>
                                                </svg>
                                                Start Instance  
                                            </button>
                                            <button type="button" class="btn btn-warning btn-sm">
                                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-stop-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5A1.5 1.5 0 0 1 5 3.5z"/>
                                                </svg>
                                                Stop Instance  
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                                            </div>
                                        </th>
                                    <td>Database</td>
                                    <td>i-0903774b3c2136408</td>
                                    <td>Stopped</td>
                                    <td>t2.micro</td>
                                    <td>ap-southeast-1</td>
                                    <td>
                                        <button type="button" class="btn btn-success btn-sm" id="start" onclick="onSignIn()">
                                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-power" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" d="M5.578 4.437a5 5 0 1 0 4.922.044l.5-.866a6 6 0 1 1-5.908-.053l.486.875z"/>
                                                <path fill-rule="evenodd" d="M7.5 8V1h1v7h-1z"/>
                                            </svg>
                                            Start Instance  
                                        </button>
                                        <button type="button" class="btn btn-warning btn-sm">
                                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-stop-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5A1.5 1.5 0 0 1 5 3.5z"/>
                                            </svg>
                                            Stop Instance  
                                        </button>
                                    </td>
                                    </tr>
                            </table>
                        </div>
                        <button type="button" class="btn btn-primary" id="create_ec2">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-plus" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                            </svg>
                            Create Instance  
                        </button>
                        <button type="button" class="btn btn-danger">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-trash2" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M3.18 4l1.528 9.164a1 1 0 0 0 .986.836h4.612a1 1 0 0 0 .986-.836L12.82 4H3.18zm.541 9.329A2 2 0 0 0 5.694 15h4.612a2 2 0 0 0 1.973-1.671L14 3H2l1.721 10.329z"/>
                                <path d="M14 3c0 1.105-2.686 2-6 2s-6-.895-6-2 2.686-2 6-2 6 .895 6 2z"/>
                                <path fill-rule="evenodd" d="M12.9 3c-.18-.14-.497-.307-.974-.466C10.967 2.214 9.58 2 8 2s-2.968.215-3.926.534c-.477.16-.795.327-.975.466.18.14.498.307.975.466C5.032 3.786 6.42 4 8 4s2.967-.215 3.926-.534c.477-.16.795-.327.975-.466zM8 5c3.314 0 6-.895 6-2s-2.686-2-6-2-6 .895-6 2 2.686 2 6 2z"/>
                            </svg>
                            Terminate
                        </button>
                    </div>
                    <div class="card-footer bg-warning">
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-exclamation-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                        </svg>
                        EC2 Instance will automatically be terminated at the end of the conducting laboratory day (23:59 P.M.)
                    </div>
                </div>  
            </div>
        </div>
    </div>

    <nav class="navbar text-center fixed-bottom navbar-light bg-light ">
        <span class="navbar-text">
            Developed By Super Junior
        </span>
    </nav>

    <script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-database.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.766.0.min.js"></script>
    <script type="text/javascript">
        
        document.getElementById ("create_ec2").addEventListener ("click", createEC2, false);

        var id_token;

        function createEC2() {
            // Firebase Configuration
            var config = {
                apiKey: "AIzaSyD_jLPkUWTOE0CdwQyk7oY90SS_TvV8-SE",
                authDomain: "aws-resource-management-e968b.firebaseapp.com",
                databaseURL: "https://aws-resource-management-e968b.firebaseio.com",
                storageBucket: "aws-resource-management-e968b.appspot.com"
            };
            firebase.initializeApp(config);

            // Retrieve token from firebase
            var dbRefUser = firebase.database().ref().child('user');
            

            dbRefUser.once('value', snap => snap.forEach(childSnapshot => console.log(childSnapshot.val().token)))

            dbRefUser.once("value", function(snapshot) {
                snapshot.forEach(function(childSnapshot) {
                id_token = childSnapshot.val().token;
                console.log(typeof id_token)
                
                });
            });
            // Add the Google access token to the Amazon Cognito credentials login map.
            AWS.config.region = 'ap-southeast-1'; // Region
            AWS.config.credentials = new AWS.CognitoIdentityCredentials({
                IdentityPoolId: 'ap-southeast-1:71ff44b8-44ce-4db4-9770-21fc33249a21',
                Logins: {
                'accounts.google.com': String(id_token)
                }
            });
            // Create EC2 service object
            

            // AMI is amzn-ami-2011.09.1.x86_64-ebs
            var instanceParams = {
            ImageId: 'ami-0cd31be676780afa7', 
            InstanceType: 't2.micro',
            KeyName: 'ec2-keypair',
            MinCount: 1,
            MaxCount: 1,
            TagSpecifications: [
                    {
                        ResourceType:'instance',
                        Tags: [
                            {
                                Key: 'StudentID',
                                Value: '60070060'
                            }
                        ]
                    }
                ]
            };
            var ec2 = new AWS.EC2({apiVersion: '2016-11-15'})
            var instancePromise = new AWS.EC2({apiVersion: '2016-11-15'}).runInstances(instanceParams).promise();
        }
    </script>
    <script src="https://apis.google.com/js/platform.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    
</body>
</html>